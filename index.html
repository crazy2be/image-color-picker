<!DOCTYPE html>
<html>
<head>
    <title>Drag and drop, automatic upload</title>
    <style>
#info {
    position: absolute;
    z-index: 10;
    top: 0px;
    left: 0px;
    width: 100px;
    bottom: 0px;
    background: #ddd;
    box-shadow: 3px 0px 3px #888;
}
#image-pane {
    position: absolute;
    top: 0px;
    left: 100px;
    right: 0px;
    bottom: 0px;
    overflow: auto;
}
#image-pane * {
    -webkit-user-drag: none;
}
#image-pane.dragover {
    border: 10px solid yellow;
}
#image-pane.loading {
    background: #eee;
}
#image-pane.loading img {
    opacity: 0.25;
}
table {
    width: 100%;
    height: 100%;
}
#content {
    text-align: center;
    vertical-align: middle;
}
input {
    width: 100px;
    border: none;
}
    </style>
</head>

<body>
    <div id="info"></div>
    <div id="image-pane">
        <table>
            <tr>
                <td id="content"></td>
            </tr>
        </table>
    </div>
    <script>
var content = document.getElementById('content');
function acceptedType(type) {
    switch (type) {
    case 'image/png': return true;
    case 'image/jpeg': return true;
    default: return false;
    }
}
function openFile(file) {
    if (!acceptedType(file.type)) {
        throw "File has invalid type!";
    }
    imagePane.classList.add('loading');
    var reader = new FileReader();
    reader.onload = function (event) {
        var img = new Image();
        img.src = event.target.result;
        img.style.zoom = 1;
        content.innerHTML = '';
        content.appendChild(img);
        imagePane.classList.remove('loading');
    };

    reader.readAsDataURL(file);
}

function offset(elm) {
    var obj = elm.getBoundingClientRect();
    return {
        top: obj.top,
        left: obj.left,
        width: obj.width,
        height: obj.height
    };
}

var imagePane = document.getElementById('image-pane');
imagePane.ondragover = function () {
    return false;
};
imagePane.ondragenter = function () {
    this.classList.add('dragover');
}
imagePane.ondragleave = function () {
    this.classList.remove('dragover');
}
imagePane.ondrop = function (e) {
    this.classList.remove('dragover');
    e.preventDefault();
    var files = e.dataTransfer.files;
    if (files.length < 1) throw "You must drop at least one file!";
    if (files.length > 1) console.warn("Only first dropped image will be used!");
    openFile(files[0]);
}
imagePane.onclick = function (e) {
    var img = content.querySelector('img');
    var canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    var c = canvas.getContext('2d');
    c.drawImage(img, 0, 0);
    var data = c.getImageData(0, 0, img.width, img.height);
    var off = offset(img);
    var x = Math.floor(e.pageX/img.style.zoom - off.left);
    var y = Math.floor(e.pageY/img.style.zoom - off.top);
    var off = ((data.width * y) + x) * 4;
    data = data.data;
    var r = data[off];
    var g = data[off + 1];
    var b = data[off + 2];
    var a = data[off + 3];

    var info = document.getElementById('info');
    function hex(n) {
        var h = Math.min(Math.max(n, 0), 255).toString(16);
        if (h.length == 1) h = '0' + h;
        return h;
    }
    info.innerHTML = '(' + x + ', ' + y + '): <br />';
    var text = document.createElement('input');
    text.value = '#' + hex(r) + hex(g) + hex(b);
    info.appendChild(text);
    text.select();
}
DragScrollable(imagePane);
document.onmousewheel = function (e) {
    if (e.altKey) {
        e.preventDefault();
        var img = content.querySelector('img');
        if (img) {
            var s = img.style;
            var d = e.wheelDelta;
            if (d < 0) {
                s.zoom /= 2;
            } else {
                s.zoom *= 2;
            }
        }
        console.log(e.wheelDelta);
        return false;
    }
}

function DragScrollable(elm) {
    var prevX, prevY, prevClick, hasMoved;
    elm.onmousedown = mouseDown;

    function mouseDown(ev) {
        if (event.which !== 1) return false;
        prevX = event.clientX;
        prevY = event.clientY;
        document.onmousemove = mouseMove;
        document.onmouseup = mouseUp;
        hasMoved = false;
        return false;
    }

    function mouseMove(ev) {
        var dx = event.clientX - prevX;
        var dy = event.clientY - prevY;
        elm.scrollLeft -= dx;
        elm.scrollTop -= dy;
        prevX = event.clientX;
        prevY = event.clientY;
        hasMoved = true;
    }

    function mouseUp(ev) {
        document.onmousemove = null;
        document.onmouseup = null;
        if (hasMoved) {
            if (elm.onclick) {
                prevClick = elm.onclick;
                elm.onclick = null;
            }
        } else {
            if (prevClick) {
                elm.onclick = prevClick;
            }
        }
    }
}
</script>
</body>
</html>
